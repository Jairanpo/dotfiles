#!/usr/bin/env bash

echo 'write your pattern'
read pattern
echo "This is you pattern: $pattern"

mapfile -t selected < <(grep -rli --exclude-dir=node_modules --exclude-dir=venv "${pattern}" .)

echo "Files found:"

case ${#selected[@]} in
    0)
        echo "No files found matching pattern."
        ;;
    1)
        # If exactly one file is found, automatically use it.
        nvim ${selected[0]} 
        exit 0
        ;;
    *)
        # If more than one file is found, let the user choose.
        echo "Files found:"
        for i in "${!selected[@]}"; do
          echo "$((i+1))) ${selected[$i]}"
        done

        echo "Please choose a file by entering its number:"
        read choice

        # Adjust the choice to array index
        index=$((choice-1))

        # Validate the choice and act accordingly
        if [[ index -ge 0 && index -lt ${#selected[@]} ]]; then
            nvim "${selected[$index]}"
            exit 0
            echo "You selected: ${selected[$index]}"
        else
            echo "Invalid selection. Please run the script again and select a valid number."
            exit 1
        fi
        ;;
esac
